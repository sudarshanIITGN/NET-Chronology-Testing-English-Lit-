<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Literature Chronology Quiz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: auto;
      padding: 20px;
      background: #fafafa;
    }
    .card {
      border: 1px solid #ddd;
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
      background: white;
    }
    button {
      padding: 10px 20px;
      cursor: pointer;
      margin-top: 10px;
    }
    input {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 16px;
    }
  </style>
</head>

<body>
  <h1>Literature Chronology Quiz</h1>
  <p>Arrange the following works in the correct chronological order.</p>

  <div id="quiz" class="card"></div>
  <div id="result" class="card" style="display:none;"></div>

  <script>
    let data = [];
    let current = null;
    let score = 0;

    // Load CSV file
    async function loadCSV() {
      try {
        const response = await fetch('works.csv');
        const text = await response.text();

        const rows = text.trim().split('\n').map(r => r.split(','));

        // Expect header: work,year
        data = rows.slice(1).map(r => ({
          work: r[0],
          year: parseInt(r[1])
        })).filter(x => x.work && !isNaN(x.year));

        if (data.length === 0) {
          document.getElementById("quiz").innerHTML = "No data found in works.csv";
          return;
        }

        newQuestion();

      } catch (e) {
        document.getElementById("quiz").innerHTML =
          "Error loading CSV. Make sure works.csv is in the same folder.";
      }
    }

    // Generate a new question
    function newQuestion() {
      let items = [...data]
        .sort(() => Math.random() - 0.5)
        .slice(0, 4);

      current = items;

      const quizDiv = document.getElementById('quiz');
      const resultDiv = document.getElementById('result');
      resultDiv.style.display = 'none';

      quizDiv.innerHTML = "<strong>Arrange by year (oldest to newest):</strong><br><br>";

      items.forEach((it, idx) => {
        quizDiv.innerHTML += `${idx + 1}. ${it.work}<br>`;
      });

      quizDiv.innerHTML += `
        <input id="answer" placeholder="Enter order e.g. 2 3 1 4" />
        <button onclick="checkAnswer()">Submit</button>
      `;
    }

    // Check user's answer
    function checkAnswer() {
      const ans = document.getElementById('answer').value.trim().split(/\s+/);

      if (ans.length !== 4) {
        alert("Enter exactly four numbers separated by spaces.");
        return;
      }

      const sorted = [...current].sort((a, b) => a.year - b.year);
      const correctOrder = sorted.map(x => current.indexOf(x) + 1);
      const userOrder = ans.map(Number);

      const isCorrect = JSON.stringify(userOrder) === JSON.stringify(correctOrder);
      if (isCorrect) score++;

      const resultDiv = document.getElementById("result");
      resultDiv.style.display = "block";

      resultDiv.innerHTML = `
        <strong>Correct Order:</strong> ${correctOrder.join(' ')}<br><br>
        ${sorted.map(x => `${x.year} â€“ ${x.work}`).join('<br>')}
        <br><br>
        <strong>Your Score:</strong> ${score}
        <br><br>
        <button onclick="newQuestion()">Next Question</button>
      `;
    }

    loadCSV();
  </script>
</body>
</html>
